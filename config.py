from librosa import fft_frequencies
from librosa.core import frames_to_time

## base params

act_classical_rnn = False

## data params

sample_rate = 8_000 # 22_050 # 44_100

fft_bins = 2048
fft_window_len = fft_bins
fft_hop_len = fft_window_len//4

mfcc_bins = 20
mel_bins = 128

silence_thr_db = 0

frequencies_of_bins = list(fft_frequencies(sample_rate, fft_bins))
frequencies_to_pick = [] # [0.0, 3.90625, 7.8125, 11.71875, 15.625, 19.53125, 23.4375, 27.34375, 31.25, 35.15625, 39.0625, 42.96875, 46.875, 50.78125, 54.6875, 58.59375, 62.5, 66.40625, 70.3125, 74.21875, 78.125, 82.03125, 85.9375, 89.84375, 93.75, 97.65625, 101.5625, 105.46875, 109.375, 113.28125, 117.1875, 121.09375, 125.0, 128.90625, 132.8125, 136.71875, 140.625, 144.53125, 148.4375, 152.34375, 156.25, 160.15625, 164.0625, 167.96875, 171.875, 175.78125, 179.6875, 183.59375, 187.5, 191.40625, 195.3125, 199.21875, 203.125, 207.03125, 210.9375, 214.84375, 218.75, 222.65625, 226.5625, 230.46875, 234.375, 238.28125, 242.1875, 246.09375, 250.0, 253.90625, 257.8125, 261.71875, 265.625, 269.53125, 273.4375, 277.34375, 281.25, 285.15625, 289.0625, 292.96875, 296.875, 300.78125, 304.6875, 308.59375, 312.5, 316.40625, 320.3125, 324.21875, 328.125, 332.03125, 335.9375, 339.84375, 343.75, 347.65625, 351.5625, 355.46875, 359.375, 363.28125, 367.1875, 371.09375, 375.0, 378.90625, 382.8125, 386.71875, 390.625, 394.53125, 398.4375, 402.34375, 406.25, 410.15625, 414.0625, 417.96875, 421.875, 425.78125, 429.6875, 433.59375, 437.5, 441.40625, 445.3125, 449.21875, 453.125, 457.03125, 460.9375, 464.84375, 468.75, 472.65625, 476.5625, 480.46875, 484.375, 488.28125, 492.1875, 496.09375, 500.0, 503.90625, 507.8125, 511.71875, 515.625, 519.53125, 523.4375, 527.34375, 531.25, 535.15625, 539.0625, 542.96875, 546.875, 550.78125, 554.6875, 558.59375, 562.5, 566.40625, 570.3125, 574.21875, 578.125, 582.03125, 585.9375, 589.84375, 593.75, 597.65625, 601.5625, 605.46875, 609.375, 613.28125, 617.1875, 621.09375, 625.0, 628.90625, 632.8125, 636.71875, 640.625, 644.53125, 648.4375, 652.34375, 656.25, 660.15625, 664.0625, 667.96875, 671.875, 675.78125, 679.6875, 683.59375, 687.5, 691.40625, 695.3125, 699.21875, 703.125, 707.03125, 710.9375, 714.84375, 718.75, 722.65625, 726.5625, 730.46875, 734.375, 738.28125, 742.1875, 746.09375, 750.0, 753.90625, 757.8125, 761.71875, 765.625, 769.53125, 773.4375, 777.34375, 781.25, 785.15625, 789.0625, 792.96875, 796.875, 800.78125, 804.6875, 808.59375, 812.5, 816.40625, 820.3125, 824.21875, 828.125, 832.03125, 835.9375, 839.84375, 843.75, 847.65625, 851.5625, 855.46875, 859.375, 863.28125, 867.1875, 871.09375, 875.0, 878.90625, 882.8125, 886.71875, 890.625, 894.53125, 898.4375, 902.34375, 906.25, 910.15625, 914.0625, 917.96875, 921.875, 925.78125, 929.6875, 933.59375, 937.5, 941.40625, 945.3125, 949.21875, 953.125, 957.03125, 960.9375, 964.84375, 968.75, 972.65625, 976.5625, 980.46875, 984.375, 988.28125, 992.1875, 996.09375, 1000.0, 1003.90625, 1007.8125, 1011.71875, 1015.625, 1019.53125, 1023.4375, 1027.34375, 1031.25, 1035.15625, 1039.0625, 1042.96875, 1046.875, 1050.78125, 1054.6875, 1058.59375, 1062.5, 1066.40625, 1070.3125, 1074.21875, 1078.125, 1082.03125, 1085.9375, 1089.84375, 1093.75, 1097.65625, 1101.5625, 1105.46875, 1109.375, 1113.28125, 1117.1875, 1121.09375, 1125.0, 1128.90625, 1132.8125, 1136.71875, 1140.625, 1144.53125, 1148.4375, 1152.34375, 1156.25, 1160.15625, 1164.0625, 1167.96875, 1171.875, 1175.78125, 1179.6875, 1183.59375, 1187.5, 1191.40625, 1195.3125, 1199.21875, 1203.125, 1207.03125, 1210.9375, 1214.84375, 1218.75, 1222.65625, 1226.5625, 1230.46875, 1234.375, 1238.28125, 1242.1875, 1246.09375, 1250.0, 1253.90625, 1257.8125, 1261.71875, 1265.625, 1269.53125, 1273.4375, 1277.34375, 1281.25, 1285.15625, 1289.0625, 1292.96875, 1296.875, 1300.78125, 1304.6875, 1308.59375, 1312.5, 1316.40625, 1320.3125, 1324.21875, 1328.125, 1332.03125, 1335.9375, 1339.84375, 1343.75, 1347.65625, 1351.5625, 1355.46875, 1359.375, 1363.28125, 1367.1875, 1371.09375, 1375.0, 1378.90625, 1382.8125, 1386.71875, 1390.625, 1394.53125, 1398.4375, 1402.34375, 1406.25, 1410.15625, 1414.0625, 1417.96875, 1421.875, 1425.78125, 1429.6875, 1433.59375, 1437.5, 1441.40625, 1445.3125, 1449.21875, 1453.125, 1457.03125, 1460.9375, 1464.84375, 1468.75, 1472.65625, 1476.5625, 1480.46875, 1484.375, 1488.28125, 1492.1875, 1496.09375, 1500.0, 1503.90625, 1507.8125, 1511.71875, 1515.625, 1519.53125, 1523.4375, 1527.34375, 1531.25, 1535.15625, 1539.0625, 1542.96875, 1546.875, 1550.78125, 1554.6875, 1558.59375, 1562.5, 1566.40625, 1570.3125, 1574.21875, 1578.125, 1582.03125, 1585.9375, 1589.84375, 1593.75, 1597.65625, 1601.5625, 1605.46875, 1609.375, 1613.28125, 1617.1875, 1621.09375, 1625.0, 1628.90625, 1632.8125, 1636.71875, 1640.625, 1644.53125, 1648.4375, 1652.34375, 1656.25, 1660.15625, 1664.0625, 1667.96875, 1671.875, 1675.78125, 1679.6875, 1683.59375, 1687.5, 1691.40625, 1695.3125, 1699.21875, 1703.125, 1707.03125, 1710.9375, 1714.84375, 1718.75, 1722.65625, 1726.5625, 1730.46875, 1734.375, 1738.28125, 1742.1875, 1746.09375, 1750.0, 1753.90625, 1757.8125, 1761.71875, 1765.625, 1769.53125, 1773.4375, 1777.34375, 1781.25, 1785.15625, 1789.0625, 1792.96875, 1796.875, 1800.78125, 1804.6875, 1808.59375, 1812.5, 1816.40625, 1820.3125, 1824.21875, 1828.125, 1832.03125, 1835.9375, 1839.84375, 1843.75, 1847.65625, 1851.5625, 1855.46875, 1859.375, 1863.28125, 1867.1875, 1871.09375, 1875.0, 1878.90625, 1882.8125, 1886.71875, 1890.625, 1894.53125, 1898.4375, 1902.34375, 1906.25, 1910.15625, 1914.0625, 1917.96875, 1921.875, 1925.78125, 1929.6875, 1933.59375, 1937.5, 1941.40625, 1945.3125, 1949.21875, 1953.125, 1957.03125, 1960.9375, 1964.84375, 1968.75, 1972.65625, 1976.5625, 1980.46875, 1984.375, 1988.28125, 1992.1875, 1996.09375, 2000.0, 2003.90625, 2007.8125, 2011.71875, 2015.625, 2019.53125, 2023.4375, 2027.34375, 2031.25, 2035.15625, 2039.0625, 2042.96875, 2046.875, 2050.78125, 2054.6875, 2058.59375, 2062.5, 2066.40625, 2070.3125, 2074.21875, 2078.125, 2082.03125, 2085.9375, 2089.84375, 2093.75, 2097.65625, 2101.5625, 2105.46875, 2109.375, 2113.28125, 2117.1875, 2121.09375, 2125.0, 2128.90625, 2132.8125, 2136.71875, 2140.625, 2144.53125, 2148.4375, 2152.34375, 2156.25, 2160.15625, 2164.0625, 2167.96875, 2171.875, 2175.78125, 2179.6875, 2183.59375, 2187.5, 2191.40625, 2195.3125, 2199.21875, 2203.125, 2207.03125, 2210.9375, 2214.84375, 2218.75, 2222.65625, 2226.5625, 2230.46875, 2234.375, 2238.28125, 2242.1875, 2246.09375, 2250.0, 2253.90625, 2257.8125, 2261.71875, 2265.625, 2269.53125, 2273.4375, 2277.34375, 2281.25, 2285.15625, 2289.0625, 2292.96875, 2296.875, 2300.78125, 2304.6875, 2308.59375, 2312.5, 2316.40625, 2320.3125, 2324.21875, 2328.125, 2332.03125, 2335.9375, 2339.84375, 2343.75, 2347.65625, 2351.5625, 2355.46875, 2359.375, 2363.28125, 2367.1875, 2371.09375, 2375.0, 2378.90625, 2382.8125, 2386.71875, 2390.625, 2394.53125, 2398.4375, 2402.34375, 2406.25, 2410.15625, 2414.0625, 2417.96875, 2421.875, 2425.78125, 2429.6875, 2433.59375, 2437.5, 2441.40625, 2445.3125, 2449.21875, 2453.125, 2457.03125, 2460.9375, 2464.84375, 2468.75, 2472.65625, 2476.5625, 2480.46875, 2484.375, 2488.28125, 2492.1875, 2496.09375, 2500.0, 2503.90625, 2507.8125, 2511.71875, 2515.625, 2519.53125, 2523.4375, 2527.34375, 2531.25, 2535.15625, 2539.0625, 2542.96875, 2546.875, 2550.78125, 2554.6875, 2558.59375, 2562.5, 2566.40625, 2570.3125, 2574.21875, 2578.125, 2582.03125, 2585.9375, 2589.84375, 2593.75, 2597.65625, 2601.5625, 2605.46875, 2609.375, 2613.28125, 2617.1875, 2621.09375, 2625.0, 2628.90625, 2632.8125, 2636.71875, 2640.625, 2644.53125, 2648.4375, 2652.34375, 2656.25, 2660.15625, 2664.0625, 2667.96875, 2671.875, 2675.78125, 2679.6875, 2683.59375, 2687.5, 2691.40625, 2695.3125, 2699.21875, 2703.125, 2707.03125, 2710.9375, 2714.84375, 2718.75, 2722.65625, 2726.5625, 2730.46875, 2734.375, 2738.28125, 2742.1875, 2746.09375, 2750.0, 2753.90625, 2757.8125, 2761.71875, 2765.625, 2769.53125, 2773.4375, 2777.34375, 2781.25, 2785.15625, 2789.0625, 2792.96875, 2796.875, 2800.78125, 2804.6875, 2808.59375, 2812.5, 2816.40625, 2820.3125, 2824.21875, 2828.125, 2832.03125, 2835.9375, 2839.84375, 2843.75, 2847.65625, 2851.5625, 2855.46875, 2859.375, 2863.28125, 2867.1875, 2871.09375, 2875.0, 2878.90625, 2882.8125, 2886.71875, 2890.625, 2894.53125, 2898.4375, 2902.34375, 2906.25, 2910.15625, 2914.0625, 2917.96875, 2921.875, 2925.78125, 2929.6875, 2933.59375, 2937.5, 2941.40625, 2945.3125, 2949.21875, 2953.125, 2957.03125, 2960.9375, 2964.84375, 2968.75, 2972.65625, 2976.5625, 2980.46875, 2984.375, 2988.28125, 2992.1875, 2996.09375, 3000.0, 3003.90625, 3007.8125, 3011.71875, 3015.625, 3019.53125, 3023.4375, 3027.34375, 3031.25, 3035.15625, 3039.0625, 3042.96875, 3046.875, 3050.78125, 3054.6875, 3058.59375, 3062.5, 3066.40625, 3070.3125, 3074.21875, 3078.125, 3082.03125, 3085.9375, 3089.84375, 3093.75, 3097.65625, 3101.5625, 3105.46875, 3109.375, 3113.28125, 3117.1875, 3121.09375, 3125.0, 3128.90625, 3132.8125, 3136.71875, 3242.1875, 3246.09375, 3250.0, 3253.90625, 3257.8125, 3261.71875, 3265.625, 3269.53125, 3273.4375, 3277.34375, 3281.25, 3285.15625, 3289.0625, 3292.96875, 3296.875, 3300.78125, 3304.6875, 3308.59375, 3312.5, 3316.40625, 3320.3125, 3324.21875, 3328.125]
 #[i for i, f in enumerate(frequencies_of_bins) if band_low_hz <= f <= band_high_hz]
frequency_strength_thr = 1e2
times_of_bins = lambda hm_steps: frames_to_time(range(0,hm_steps), sample_rate, fft_hop_len, fft_bins)

zscore_scale = True
minmax_scale = False
log_scale = False

data_path = 'data'
dev_ratio = 0

## model params

hm_steps_back = 0
timestep_size = len(frequencies_to_pick)
in_size = timestep_size*(hm_steps_back+1)
hm_modalities = 1
out_size = timestep_size*hm_modalities*3 if not act_classical_rnn else timestep_size
creation_info = [in_size,'l',512,'f',out_size]

init_xavier = True
forget_bias = 0

## train params

seq_window_len = 100
seq_stride_len = seq_window_len-1
seq_force_ratio = 1

loss_squared = True

learning_rate = 5e-4
batch_size = 0
gradient_clip = 0
hm_epochs = 500
optimizer = 'custom'

model_path = 'models/model'
fresh_model = True
fresh_meta = True
ckp_per_ep = 50

use_gpu = False

## interact params

hm_extra_steps = seq_window_len

hm_wav_gen = 1

output_file = 'resp'

##

config_to_save = ['sample_rate', 'fft_bins', 'fft_window_len', 'fft_hop_len', 'mfcc_bins', 'mel_bins',
                  'frequency_strength_thr', 'frequencies_of_bins', 'frequencies_to_pick',
                  'zscore_scale', 'minmax_scale', 'log_scale',
                  'hm_steps_back', 'in_size', 'hm_modalities', 'out_size',
                  'seq_window_len', 'seq_stride_len', 'seq_force_len',]
